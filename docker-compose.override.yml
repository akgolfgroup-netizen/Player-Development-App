# =============================================================================
# Docker Compose Override for Development
# =============================================================================
# This file automatically extends docker-compose.yml in development
# It adds volume mounts for hot-reload and debug configurations
#
# Usage: docker-compose up (automatically loads both files)
# =============================================================================

version: '3.8'

services:
  # =============================================================================
  # PostgreSQL - Development Configuration
  # =============================================================================
  db:
    # Expose port for direct database access with tools like pgAdmin
    ports:
      - "${DB_PORT:-5432}:5432"
    # Enable logging for debugging
    command: >
      postgres
      -c log_statement=all
      -c log_destination=stderr
    environment:
      # Use simpler credentials for development
      POSTGRES_USER: ${DB_USER:-iup_golf}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-dev_password}
      POSTGRES_DB: ${DB_NAME:-iup_golf}

  # =============================================================================
  # Redis - Development Configuration
  # =============================================================================
  redis:
    ports:
      - "${REDIS_PORT:-6379}:6379"

  # =============================================================================
  # API Backend - Development Configuration
  # =============================================================================
  api:
    # Use development command with hot-reload
    command: npm run dev
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
      LOG_PRETTY: "true"
    # Mount source code for hot-reload
    volumes:
      - ./apps/api/src:/app/src:delegated
      - ./apps/api/prisma:/app/prisma:delegated
      # Exclude node_modules from mount
      - /app/node_modules
    # Expose debug port for Node.js debugging
    ports:
      - "${API_PORT:-3000}:3000"
      - "9229:9229"  # Node.js debugger

  # =============================================================================
  # Web Frontend - Development Configuration
  # =============================================================================
  web:
    # Use development command with hot-reload
    command: npm run dev
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: "true"  # For file watching in Docker
    # Mount source code for hot-reload
    volumes:
      - ./apps/web/src:/app/src:delegated
      - ./apps/web/public:/app/public:delegated
      # Exclude node_modules from mount
      - /app/node_modules
    ports:
      - "${WEB_PORT:-3001}:3001"

# =============================================================================
# Development-only volumes
# =============================================================================
volumes:
  postgres_data:
    # Use local driver for development
    driver: local
  redis_data:
    driver: local
